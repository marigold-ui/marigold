#!/usr/bin/env zx
// @ts-nocheck
import fs from 'fs';
import path, { basename } from 'path';
import { glob } from 'zx';

let demoPath = await glob([`content/components/**/**.demo.tsx`]);

let index = `// @ts-nocheck
// This file is autogenerated by scripts/build-registry.ts
// Do not edit this file directly.
import dynamic from 'next/dynamic';

export const Index: Record<string, any> = {
`;

for (const item of demoPath) {
  const name = basename(item, '.demo.tsx');
  index += `
    "${name}": {
      name: "${name}",
      demo: dynamic(
        () => import('@/${item.replace('.tsx', '')}')
      ),
      file: "${item}",
    },`;
}
index += `
}`;

fs.writeFileSync(path.join(process.cwd(), '__registry__/index.tsx'), index);
console.log('âœ… registry build');
