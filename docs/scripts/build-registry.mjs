#!/usr/bin/env zx
// Registry of demos ideas is based on https://github.com/shadcn/ui !
/* global fs */
import path, { basename } from 'path';
import { glob } from 'zx';

let demoPath = await glob([`content/**/**/**.demo.tsx`]);

console.log('ðŸ“‘ Building registry...');

let index = `// @ts-nocheck
// This file is autogenerated by scripts/build-registry.ts
// Do not edit this file directly.
import dynamic from 'next/dynamic';

export const registry = {`;

for (const item of demoPath) {
  const name = basename(item, '.demo.tsx');
  index += `
  '${name}': {
    name: '${name}',
    demo: dynamic(
      () => import('@/${item.replace('.tsx', '')}')
    ),
    file: '${item}',
  },`;
}
index += `
} as const;`;

fs.outputFileSync(path.join(process.cwd(), '.registry/demos.tsx'), index);
console.log(`âœ… Successfully built ${demoPath.length} registry items!\n`);
