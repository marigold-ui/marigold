import path, { basename, dirname } from 'path';
import { fileURLToPath } from 'url';
import { globby } from 'zx';

let index = `// @ts-nocheck
// This file is autogenerated by scripts/build-registry.ts
// Do not edit this file directly.
import dynamic from 'next/dynamic';

export const changelog = {`;

let changelogPath = await globby([
  '../{docs,packages}/{**,*}/CHANGELOG.md',
  '!../**/node_modules/**',
]);

for (const item of changelogPath) {
  const packages = path.dirname(item);
  const changelogFile = `${packages}/CHANGELOG.md`;
  console.log(changelogFile);

  index += `
      '${changelogFile}': {
        slug: '${changelogFile}',
      },`;
}
index += `
} as const;`;

// fs.outputFileSync(path.join(process.cwd(), '.changelog.tsx'), index);
