version: 2 # .1
# orbs:
# coveralls: coveralls/coveralls@3.0.9
on: ['push', 'pull_request']
jobs:
  test:
    docker:
      - image: circleci/node:12
        environment:
          - COVERALLS_REPO_TOKEN: '${{ secrets.COVERALLS_REPO_TOKEN }}'
    post:
      - coveralls
    steps:
      - checkout
      - run: yarn install
      - run: yarn test --ci
  coveralls:
    docker:
      - image: circleci/node:12
    steps:
      - checkout
      - run: yarn install
      - run: yarn test --coverage --coverageReporters=text-lcov | coveralls
workflows:
  version: 2
  test_job:
    jobs:
      - test
      - coveralls
