version: 2
on: ['push', 'pull_request']
jobs:
  test:
    docker:
      - image: circleci/node:12
        environment:
          - COVERALLS_REPO_TOKEN: '${{ secrets.COVERALLS_REPO_TOKEN }}'
    post:
      - coveralls
    steps:
      - checkout
      - run: yarn install
      - run:
          name: Run test and create coverage artifact
          command: yarn test --ci --coverage --coverageReporters=text-lcov
      - store_artifacts:
          path: coverage
  coverage:
    docker:
      - image: circleci/node:12
    steps:
      - checkout
      # - run: yarn install
      - run: ls
workflows:
  version: 2
  test_job:
    jobs:
      - test
      - coverage
